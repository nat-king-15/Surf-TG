<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/weebzone/weebzone/data/Surf-TG/src/ico2.png" type="image/x-icon">
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/weebzone/weebzone/data/Surf-TG/src/ico2.png"
        type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <title>Natking-TG: <!-- Filename --> </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/weebzone/weebzone/data/Surf-TG/css/plyr.css">
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script disable-devtool-auto src='https://cdn.jsdelivr.net/npm/disable-devtool'></script>
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        .navbar {
            background: rgba(15, 15, 26, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .navbar img {
            height: 36px;
        }

        .navbar .btn-logout {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border-radius: 10px;
            padding: 6px 14px;
            font-size: 0.8rem;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
        }

        .video-wrapper {
            width: 100%;
            max-width: 900px;
            margin: 20px auto;
            padding: 0 16px;
            position: relative;
        }

        .plyr {
            border-radius: 16px;
            overflow: hidden;
        }

        .plyr--video {
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
        }

        /* ── Seek indicator (injected inside .plyr) ── */
        .seek-indicator {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            opacity: 0;
            transform: scale(0.7);
            pointer-events: none;
            z-index: 50;
            top: 50%;
            margin-top: -30px;
        }

        .seek-indicator.left {
            left: 15%;
        }

        .seek-indicator.right {
            right: 15%;
        }

        .seek-indicator.show {
            animation: seekPop 0.7s ease-out forwards;
        }

        .seek-indicator .seek-icon {
            font-size: 2.2rem;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
        }

        .seek-indicator .seek-text {
            font-size: 0.85rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 1px 6px rgba(0, 0, 0, 0.6);
        }

        @keyframes seekPop {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }

            25% {
                opacity: 1;
                transform: scale(1.15);
            }

            100% {
                opacity: 0;
                transform: scale(1) translateY(-12px);
            }
        }

        /* Seek ripple flash */
        .seek-flash {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            z-index: 40;
        }

        .seek-flash.left {
            left: 0;
            border-radius: 16px 0 0 16px;
            background: radial-gradient(circle at 30% 50%, rgba(255, 255, 255, 0.12), transparent 70%);
        }

        .seek-flash.right {
            right: 0;
            border-radius: 0 16px 16px 0;
            background: radial-gradient(circle at 70% 50%, rgba(255, 255, 255, 0.12), transparent 70%);
        }

        .seek-flash.animate {
            animation: flashFade 0.4s ease-out;
        }

        @keyframes flashFade {
            0% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        /* Speed indicator badge */
        .speed-indicator {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            color: #fff;
            padding: 6px 18px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 50;
            pointer-events: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .speed-indicator.show {
            opacity: 1;
        }

        /* Volume bar (right side of video) */
        .vol-gesture-bar {
            position: absolute;
            z-index: 50;
            width: 4px;
            height: 40%;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.15);
            top: 30%;
            right: 16px;
            opacity: 0;
            transition: opacity 0.25s;
            pointer-events: none;
        }

        .vol-gesture-bar .fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            border-radius: 4px;
            background: #00d4ff;
            transition: height 0.08s;
        }

        .vol-gesture-bar .g-icon {
            position: absolute;
            top: -28px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            color: #fff;
        }

        .vol-gesture-bar.show {
            opacity: 1;
        }

        /* File info card */
        .file-info {
            max-width: 900px;
            margin: 0 auto 20px;
            padding: 0 16px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 14px;
            padding: 16px 20px;
        }

        .info-card h6 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #e0e0e0;
            margin-bottom: 4px;
            word-break: break-word;
        }

        .info-card p {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.4);
            margin: 0;
        }

        /* Action buttons */
        .actions {
            max-width: 900px;
            margin: 0 auto 24px;
            padding: 0 16px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 12px 8px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            text-align: center;
        }

        .action-btn:hover,
        .action-btn:active {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }

        .action-btn i {
            font-size: 1rem;
        }

        .footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.2);
        }

        .footer a {
            color: rgba(255, 255, 255, 0.3);
        }

        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
        }

        @media (max-width: 480px) {
            .actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .video-wrapper {
                padding: 0 8px;
                margin: 12px auto;
            }

            .plyr {
                border-radius: 10px;
            }

            .seek-flash.left {
                border-radius: 10px 0 0 10px;
            }

            .seek-flash.right {
                border-radius: 0 10px 10px 0;
            }
        }

        /* Fix for fullscreen */
        .plyr--fullscreen-active .plyr {
            border-radius: 0;
        }

        .plyr--fullscreen-active .seek-flash.left,
        .plyr--fullscreen-active .seek-flash.right {
            border-radius: 0;
        }

        /* Mobile Layout: Responsive Single Row */
        @media (max-width: 480px) {
            .plyr__controls {
                flex-wrap: nowrap !important;
                overflow-x: auto !important;
                overflow-y: hidden !important;
                justify-content: flex-start !important;
                padding: 10px 5px !important;
                gap: 5px !important;
            }

            /* Make progress bar flexible but visible */
            .plyr__progress__container {
                flex: 1 1 auto !important;
                min-width: 80px !important;
                order: 3 !important;
                /* Play(1), Time(2), Progress(3) ... */
            }

            /* Ensure Play and Time are first */
            .plyr__controls__item[data-plyr="play"] {
                order: 1 !important;
            }

            .plyr__time {
                order: 2 !important;
                font-size: 12px !important;
                padding: 0 5px !important;
            }

            /* Volume and others after progress */
            .plyr__volume {
                order: 4 !important;
                min-width: auto !important;
                width: auto !important;
            }

            /* Hide volume slider on mobile to save space, just keep mute button if needed, 
               or let Plyr handle it (Plyr usually hides volume slider on mobile). 
            */

            /* Settings/Fullscreen at the end */
            .plyr__menu,
            .plyr__controls__item[data-plyr="fullscreen"] {
                order: 10 !important;
            }

            /* General button sizing */
            .plyr__controls__item.plyr__control {
                padding: 5px !important;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <a href="/"
            style="display: flex; align-items: center; gap: 8px; font-weight: 700; font-size: 1.2rem; color: #fff;">
            <i class="bi bi-send-fill" style="color: #00d4ff;"></i>
            <span>NATKING-TG</span>
        </a>
        <form id="signoutForm" action="/logout" method="post">
            <button type="submit" class="btn-logout"><i class="bi bi-box-arrow-left"></i> Logout</button>
        </form>
    </nav>

    <div class="video-wrapper" id="videoWrapper">
        <video controls crossorigin playsinline data-poster="<!-- Poster -->" id="player">
            <source src="#" type="video/mp4" />
        </video>
    </div>

    <div class="file-info">
        <div class="info-card">
            <h6><!-- Filename --></h6>
            <p>Size: <!-- Size --></p>
        </div>
    </div>

    <div class="actions">
        <div class="action-btn" onclick="mx_player()"><i class="bi bi-play-circle"></i> MX Player</div>
        <div class="action-btn" onclick="vlc_player()"><i class="bi bi-play-btn"></i> VLC</div>
        <div class="action-btn" onclick="km_player()"><i class="bi bi-film"></i> KM Player</div>
        <div class="action-btn" onclick="get_file()"><i class="bi bi-telegram"></i> Get File</div>
        <div class="action-btn" onclick="copyUrl()"><i class="bi bi-clipboard"></i> Copy URL</div>
        <div class="action-btn" onclick="download()"><i class="bi bi-download"></i> Download</div>
    </div>

    <div class="footer">
        Made with ❤️ by <a href="https://github.com/weebzone" target="_blank">Karan Adhikari</a><br>
        &copy; 2026 <a href="https://github.com/weebzone/Surf-TG" target="_blank">Natking-TG</a>
    </div>
</body>
<script>
    // ── URL setup ───────────────────────────────────────────────────────────
    const videolink = window.location.href;
    const baseUrl = '<!-- BaseUrl -->';
    const chatId = '<!-- ChatId -->';
    const msgId = '<!-- MsgId -->';
    const hash = '<!-- Hash -->';
    const encodedName = encodeURIComponent('<!-- Filename -->');
    const downloadlink = `${baseUrl}/${chatId}/${encodedName}?id=${msgId}&hash=${hash}`;

    // ── Plyr init (clickToPlay OFF — we handle it ourselves) ────────────────
    const player = new Plyr('#player', {
        controls: ['play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen', 'pip', 'airplay', 'settings', 'play-large', 'duration'],
        settings: ['speed'],
        speed: { selected: 1, options: [0.5, 0.75, 1, 1.25, 1.5, 2] },
        clickToPlay: false,
        hideControls: true,
        keyboard: { focused: true, global: true },
        loop: { active: false },
        tooltips: { controls: true, seek: true },
        invertTime: false,
    });

    // ── External players ────────────────────────────────────────────────────
    function mx_player() { window.location.href = `intent:${downloadlink}#Intent;package=com.mxtech.videoplayer.ad;end`; }
    function vlc_player() { window.location.href = `vlc://${downloadlink}`; }
    function km_player() { window.location.href = `intent:${downloadlink}#Intent;package=com.kmplayer;end`; }
    function download() { window.location.href = downloadlink; }
    function get_file() {
        const regex = /(\d+)\?id=(\d+)&/;
        const match = videolink.match(regex);
        if (match) {
            const chatId = "-100" + match[1];
            const messageId = match[2];
            window.location.href = `https://t.me/<!-- Username -->?start=file_${messageId}${chatId}`;
        }
    }
    function copyUrl() {
        navigator.clipboard.writeText(downloadlink)
            .then(() => alert('URL copied to clipboard!'))
            .catch((error) => console.error('Failed to copy URL: ', error));
    }
    function updateVideoSource() { document.getElementById('player').src = downloadlink; }
    window.onload = function () { updateVideoSource(); };

    // ═══════════════════════════════════════════════════════════════════════
    // ── INJECT GESTURE ELEMENTS INSIDE PLYR (so they work in fullscreen) ──
    // ═══════════════════════════════════════════════════════════════════════

    let plyrEl = null;

    function injectGestureElements() {
        plyrEl = document.querySelector('.plyr');
        if (!plyrEl) return;

        plyrEl.insertAdjacentHTML('beforeend', `
            <div class="seek-flash left" id="flashLeft"></div>
            <div class="seek-flash right" id="flashRight"></div>
            <div class="seek-indicator left" id="seekLeft">
                <span class="seek-icon"><i class="bi bi-skip-backward-fill"></i></span>
                <span class="seek-text">20s</span>
            </div>
            <div class="seek-indicator right" id="seekRight">
                <span class="seek-icon"><i class="bi bi-skip-forward-fill"></i></span>
                <span class="seek-text">20s</span>
            </div>
            <div class="speed-indicator" id="speedIndicator">
                <i class="bi bi-fast-forward-fill"></i><span>2x Speed</span>
            </div>
            <div class="vol-gesture-bar" id="volumeBar">
                <span class="g-icon"><i class="bi bi-volume-up-fill"></i></span>
                <div class="fill" id="volumeFill"></div>
            </div>
        `);

        setupGestures();
    }

    player.on('ready', injectGestureElements);

    // ═══════════════════════════════════════════════════════════════════════
    // ── GESTURE HANDLER — attached directly to .plyr container ────────────
    // ═══════════════════════════════════════════════════════════════════════

    const SEEK_SECONDS = 20;

    function getZone(clientX) {
        if (!plyrEl) return 'center';
        const rect = plyrEl.getBoundingClientRect();
        const relX = (clientX - rect.left) / rect.width;
        if (relX < 0.35) return 'left';
        if (relX > 0.65) return 'right';
        return 'center';
    }

    function isControlElement(target) {
        return target.closest('.plyr__controls') ||
            target.closest('.plyr__control') ||
            target.closest('.plyr__menu') ||
            target.closest('button');
    }

    function showSeekAnimation(side) {
        const indicator = document.getElementById(side === 'left' ? 'seekLeft' : 'seekRight');
        const flash = document.getElementById(side === 'left' ? 'flashLeft' : 'flashRight');
        if (!indicator || !flash) return;

        indicator.classList.remove('show');
        flash.classList.remove('animate');
        void indicator.offsetWidth;

        indicator.classList.add('show');
        flash.classList.add('animate');

        setTimeout(() => {
            indicator.classList.remove('show');
            flash.classList.remove('animate');
        }, 700);
    }

    function doSeek(side) {
        if (side === 'left') {
            player.currentTime = Math.max(0, player.currentTime - SEEK_SECONDS);
        } else {
            player.currentTime = Math.min(player.duration || Infinity, player.currentTime + SEEK_SECONDS);
        }
        showSeekAnimation(side);
        if (navigator.vibrate) navigator.vibrate(20);
    }

    function setupGestures() {
        if (!plyrEl) return;

        // ── Variables ──
        let tapCount = 0;
        let tapTimer = null;
        let tapZone = null;
        let longPressTimer = null;
        let isLongPress = false;
        let originalSpeed = 1;
        let swipeStartY = null;
        let swipeStartVolume = 0;
        let isSwiping = false;
        let swipeZone = null;
        let touchStartTime = 0;

        // ── TOUCH EVENTS (mobile) ──────────────────────────────────────────
        plyrEl.addEventListener('touchstart', (e) => {
            if (e.touches.length > 1) return;
            if (isControlElement(e.target)) return;

            const touch = e.touches[0];
            const zone = getZone(touch.clientX);
            touchStartTime = Date.now();

            // Swipe tracking
            swipeStartY = touch.clientY;
            swipeStartVolume = player.volume;
            swipeZone = zone;
            isSwiping = false;

            // Long press
            longPressTimer = setTimeout(() => {
                isLongPress = true;
                originalSpeed = player.speed;
                player.speed = 2;
                const badge = document.getElementById('speedIndicator');
                if (badge) badge.classList.add('show');
                if (navigator.vibrate) navigator.vibrate(30);
            }, 500);

            // Double-tap counting
            tapCount++;
            tapZone = zone;

            if (tapCount === 1) {
                tapTimer = setTimeout(() => {
                    // Single tap expired — only play/pause if center
                    if (!isSwiping && !isLongPress && tapZone === 'center') {
                        player.togglePlay();
                    }
                    tapCount = 0;
                    tapZone = null;
                }, 280);
            }
        }, { passive: false });

        plyrEl.addEventListener('touchmove', (e) => {
            if (isControlElement(e.target)) return;
            clearTimeout(longPressTimer);

            if (swipeStartY === null) return;
            const touch = e.touches[0];
            const deltaY = swipeStartY - touch.clientY;

            if (Math.abs(deltaY) > 15) {
                isSwiping = true;
            }

            if (isSwiping && swipeZone === 'right') {
                e.preventDefault();
                const sensitivity = plyrEl.offsetHeight * 0.5;
                const volumeChange = deltaY / sensitivity;
                const newVol = Math.max(0, Math.min(1, swipeStartVolume + volumeChange));
                player.volume = newVol;
                player.muted = false;

                const volBar = document.getElementById('volumeBar');
                const volFill = document.getElementById('volumeFill');
                if (volBar && volFill) {
                    volBar.classList.add('show');
                    volFill.style.height = (newVol * 100) + '%';
                    const icon = volBar.querySelector('.g-icon i');
                    if (icon) {
                        if (newVol === 0) icon.className = 'bi bi-volume-mute-fill';
                        else if (newVol < 0.5) icon.className = 'bi bi-volume-down-fill';
                        else icon.className = 'bi bi-volume-up-fill';
                    }
                }
            }
        }, { passive: false });

        plyrEl.addEventListener('touchend', (e) => {
            if (isControlElement(e.target)) return;

            // End long press
            clearTimeout(longPressTimer);
            if (isLongPress) {
                player.speed = originalSpeed;
                const badge = document.getElementById('speedIndicator');
                if (badge) badge.classList.remove('show');
                isLongPress = false;
                tapCount = 0;
                clearTimeout(tapTimer);
            }

            // End swipe
            if (isSwiping) {
                setTimeout(() => {
                    const volBar = document.getElementById('volumeBar');
                    if (volBar) volBar.classList.remove('show');
                }, 600);
                isSwiping = false;
                tapCount = 0;
                clearTimeout(tapTimer);
            }

            swipeStartY = null;

            // Handle double-tap
            if (tapCount >= 2) {
                clearTimeout(tapTimer);
                if (!isSwiping && !isLongPress && (tapZone === 'left' || tapZone === 'right')) {
                    doSeek(tapZone);
                } else if (tapZone === 'center') {
                    player.togglePlay();
                }
                tapCount = 0;
                tapZone = null;
            }
        }, { passive: true });

        plyrEl.addEventListener('touchcancel', () => {
            clearTimeout(longPressTimer);
            clearTimeout(tapTimer);
            if (isLongPress) {
                player.speed = originalSpeed;
                const badge = document.getElementById('speedIndicator');
                if (badge) badge.classList.remove('show');
            }
            isLongPress = false;
            isSwiping = false;
            tapCount = 0;
            swipeStartY = null;
            const volBar = document.getElementById('volumeBar');
            if (volBar) volBar.classList.remove('show');
        });

        // ── MOUSE EVENTS (desktop) ──────────────────────────────────────────
        // Click on center = play/pause
        plyrEl.addEventListener('click', (e) => {
            if (isControlElement(e.target)) return;
            const zone = getZone(e.clientX);
            if (zone === 'center') {
                player.togglePlay();
            }
        });

        // ── BLOCK ALL dblclick on video area (capture phase = fires BEFORE Plyr) ──
        // This completely prevents Plyr from toggling fullscreen on double-click/tap
        plyrEl.addEventListener('dblclick', (e) => {
            if (isControlElement(e.target)) return;
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            const zone = getZone(e.clientX);
            if (zone === 'left' || zone === 'right') {
                doSeek(zone);
            }
        }, true); // true = capture phase

        // Also block on the video element directly
        const videoEl = plyrEl.querySelector('video');
        if (videoEl) {
            videoEl.addEventListener('dblclick', (e) => {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
            }, true);
        }

        // Block on the plyr wrapper too
        const plyrVideoWrap = plyrEl.querySelector('.plyr__video-wrapper');
        if (plyrVideoWrap) {
            plyrVideoWrap.addEventListener('dblclick', (e) => {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
            }, true);
        }
    }

    // ── LANDSCAPE FULLSCREEN ────────────────────────────────────────────────
    player.on('enterfullscreen', () => {
        try {
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('landscape').catch(() => { });
            }
        } catch (e) { }
    });

    player.on('exitfullscreen', () => {
        try {
            if (screen.orientation && screen.orientation.unlock) {
                screen.orientation.unlock();
            }
        } catch (e) { }
    });

    // Auto-fullscreen when phone rotated to landscape while playing
    if (screen.orientation) {
        screen.orientation.addEventListener('change', () => {
            if (screen.orientation.type.includes('landscape') && player.playing && !player.fullscreen.active) {
                player.fullscreen.enter();
            }
        });
    }

    // ── KEYBOARD SEEK (desktop: arrow keys ±20s) ────────────────────────────
    document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        if (e.key === 'ArrowLeft') { e.preventDefault(); doSeek('left'); }
        else if (e.key === 'ArrowRight') { e.preventDefault(); doSeek('right'); }
    });

    // ── REMEMBER PLAYBACK POSITION ──────────────────────────────────────────
    const storageKey = `plyr_pos_${idParam}`;
    player.on('timeupdate', () => {
        if (player.currentTime > 5) {
            try { localStorage.setItem(storageKey, player.currentTime); } catch (e) { }
        }
    });
    player.on('ready', () => {
        try {
            const saved = parseFloat(localStorage.getItem(storageKey));
            if (saved && saved > 5 && saved < (player.duration - 10)) {
                player.currentTime = saved;
            }
        } catch (e) { }
    });
    player.on('ended', () => {
        try { localStorage.removeItem(storageKey); } catch (e) { }
    });
</script>

</html>